generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("MONGODB_URI")
}

model ChatHistory {
  id               String    @id @default(auto()) @map("_id") @db.ObjectId
  userId           String
  characterId      String
  messages         Message[]
  relationshipValue Int      @default(0)
  intimacyLevel    Int      @default(0)
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  @@index([userId, characterId])
}

type Message {
  role      String
  content   String
  timestamp DateTime @default(now())
  mood      String?
  intimacy  Int?    @default(0)
}

model GameProgress {
  id             String    @id @default(auto()) @map("_id") @db.ObjectId
  userId         String    @unique
  currentScene   String
  inventory      String[]
  relationships  Json
  intimacyLevels Json
  choices        Choice[]
  nfts           String[]
  isPremium      Boolean   @default(false)
  preferences    Json?
  lastSaved      DateTime  @default(now())
}

type Choice {
  sceneId    String
  choiceText String
  timestamp  DateTime @default(now())
  intimacy   Int?    @default(0)
}

model UserPreferences {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  userId      String   @unique
  interests   String[]
  boundaries  String[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}